<!DOCTYPE html>
<head>
  <script src="./includes/axios.min.js" ></script>
  <script src="./includes/plotly-2.12.1.min.js" ></script>
  <script src="./includes/slimselect.min.js"></script>
  <link href="./includes/slimselect.min.css" rel="stylesheet">

  <script>
    let data = {};
    let speciesList = null;

    axios.get('../data/daily.json').then((response) => {
      data = response.data;

      // Populate selection list
      let species = document.getElementById('Species');
      Object.keys(data.species).sort().forEach( (val) => {
        let newOption = new Option(val, val);
        species.add(newOption,undefined);
      });

      speciesList = new SlimSelect({
        select: '#Species'
      });
    });

    // Update graph when selections changes
    const rePlot = () => {
      let pdata = [];
      let selected = speciesList.selected();

      if(selected.length > 0) {
        selected.forEach( (species) => {
          let plotd = {
            y: data.species[species].sort(),
            name: species,
            type: 'violin'
          };
          pdata.push(plotd);
        });
      }
      Plotly.newPlot('Plot', pdata, {yaxis: {title: 'Time of Day of Observations (24 H)', range: [0, 24], tick0: 0, dtick: 4}, xaxis: {title: 'Species'}});
    }

    const clearList = () => {
      speciesList.set(['']);
    }

    // Quick load helper
    const quickLoad = (key) => {
      speciesList.set(data.groups[key]);
    }

    const switchTab = (el) => {
      if(el.id === 'OverviewTab') {
        document.getElementById('OverviewTab').style['background-color'] = '#EEE';
        document.getElementById('FiltersTab').style['background-color'] = '#FFF';
        document.getElementById('Overview').style.display = 'block';
        document.getElementById('Filters').style.display = 'none';
      }
      else {
        document.getElementById('OverviewTab').style['background-color'] = '#FFF';
        document.getElementById('FiltersTab').style['background-color'] = '#EEE';
        document.getElementById('Overview').style.display = 'none';
        document.getElementById('Filters').style.display = 'block';
      }
    }

  </script>
</head>

<body >
  <div style="display: flex;flex-direction: row;">
    <div style="width: 250px;padding: 5px">
        <div style="display: flex;flex-direction: row;margin-bottom: 5px">
          <div id="OverviewTab" style="flex: 1;padding: 10px;border: 1px solid #CCC;cursor: pointer;background-color: #EEE" onclick="switchTab(this)">Overview</div>
          <div id="FiltersTab" style="flex: 1;padding: 10px;border: 1px solid #CCC;cursor: pointer" onclick="switchTab(this)">Filters</div>
        </div>
        <div id="Overview">
          <p style="font-size: 1.2em">Daily Activity Analysis</p>
          <p>The daily activity graphs are called "violin" plots because of their shape. This graph is useful for seeing how often an animal is observed by the camera traps at different times during the day.</p>
          <p>In a violin plot, the wider the figure, the more photos have been taken of the given animal at that time of day.</p>
          <p>You can use the filters to narrow down what photos you are interested in. You can also select multiple species to compare. Species will be plotted alongside each other.</p>
        </div>
        <div id="Filters" style="display: none">
          <span style="font-weight: bold">Species</span><br />
          <select id="Species" multiple onChange="rePlot()"></select><br />
          <hr>
          <span style="font-weight: bold">Quick Load</span><br />
          <input value="Predators" type="button" onClick="quickLoad('predator')" /> <input value="Prey" type="button" onClick="quickLoad('prey')" /> <input value="Other" type="button" onClick="quickLoad('other')" />
          <hr>
          <input value="Clear Species List" type="button" onClick="clearList()" />
        </div>
    </div>
    <div id="Plot" style="flex: 1;min-height: 500px"></div>
  </div>

</body>
</html>

<!DOCTYPE html>
<head>
  <script src="./includes/axios.min.js" ></script>
  <script src="./includes/plotly-2.12.1.min.js" ></script>
  <script src="./includes/slimselect.min.js"></script>
  <link href="./includes/slimselect.min.css" rel="stylesheet">

  <script>
    let data = {};
    let speciesList = null;

    axios.get('../data/S1-11_filtered.json').then((response) => {
      data = response.data;

      // Populate selection list
      let species = document.getElementById('Species');
      Object.keys(data.species).sort().forEach( (val) => {
        let newOption = new Option(val, val);
        species.add(newOption,undefined);
      });

      speciesList = new SlimSelect({
        select: '#Species'
      });

      // Show controls after initialied
      document.getElementById('FilterWrapper').style.display = 'block';
    });

    // Update graph when selections changes
    const rePlot = () => {
      let pdata = [];
      let selected = speciesList.selected();

      if(selected.length > 0) {
        selected.forEach( (species) => {
          let plotd = {
            y: data.species[species].sort(),
            name: species,
            type: 'violin'
          };
          pdata.push(plotd);
        });
      }
      Plotly.newPlot('Plot', pdata, {yaxis: {title: 'Time of Day of Observations (24 H)', range: [0, 24], tick0: 0, dtick: 4}, xaxis: {title: 'Species'}});
    }

    const clearList = () => {
      console.log('here');
      speciesList.set(['']);
    }

    // Quick load helper
    const loadGrazers = () => {
      speciesList.set([
      'buffalo',
      'bushbuck',
      'dikdik',
      'eland',
      'elephant',
      'gazellegrants',
      'gazellethomsons',
      'giraffe',
      'hartebeest',
      'hippopotamus',
      'impala',
      'reedbuck',
      'rhinoceros',
      'topi',
      'warthog',
      'wildebeest',
      'zebra'
      ]);
    };

    // Quick load helper
    const loadPredators = () => {
      speciesList.set([
      'aardwolf', 
      'batearedfox',
      'caracal',
      'cheetah',
      'civet',
      'genet',
      'hyenaspotted',
      'hyenastriped',
      'jackal',
      'leopard',
      'lionfemale',
      'lionmale',
      'serval',
      'wildcat'
      ]);
    };

    // Quick load helper
    const loadOthers = () => {
      speciesList.set([
      'aardvark',
      'baboon',
      'bat',
      'birdother',
      'cattle',
      'duiker',
      'fire',
      'guineafowl',
      'hare',
      'honeybadger',
      'hyenabrown',
      'insectspider',
      'koribustard',
      'kudu',
      'lioncub',
      'mongoose',
      'monkeyvervet',
      'ostrich',
      'otherBird',
      'pangolin',
      'porcupine',
      'reptiles',
      'rodents',
      'secretarybird',
      'steenbok',
      'vervetmonkey',
      'vulture',
      'waterbuck',
      'wilddog',
      'zorilla'
      ]);
    };
  </script>
</head>

<body >
  <div style="padding: 10px">
    <p style="font-size: 1.4em">Daily Activity Analysis</p>
    <p>he daily activity graphs are called “violin” plots because of their shape. This graph is useful for seeing how often an animal is observed by the camera traps at different times during the day.</p>
    <p>In a violin plot, the wider the figure, the more photos have been taken of the given animal at that time of day.</p>
    <p>You can use the filters to narrow down what photos you are interested in. You can also select multiple species to compare. Species will be plotted alongside each other.</p>
    <hr>
    <div style="display: flex;flex-direction: row;">
      <div style="width: 250px;padding: 5px">
        <div id="FilterWrapper" style="display: none">
          <span style="font-weight: bold">Species</span><br />
          <select id="Species" multiple onChange="rePlot()"></select><br />
          <hr>
          <span style="font-weight: bold">Quick Load</span><br />
          <input value="Predators" type="button" onClick="loadPredators()" /> <input value="Grazers" type="button" onClick="loadGrazers()" /> <input value="Others" type="button" onClick="loadOthers()" />
          <hr>
          <input value="Clear Species List" type="button" onClick="clearList()" />
        </div>
      </div>
      <div id="Plot" style="flex: 1;min-height: 500px"></div>
    </div>
  </div>

</body>
</html>
